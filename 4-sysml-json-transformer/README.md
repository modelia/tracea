
# SysML-JSon TraceaLibrary

## Library

The `TraceaLibrary` alone is available in [`/10-library`](https://github.com/modelia/tracea/tree/master/4-sysml-json-transformer/10-library) with two versions of the library: with tracetypes as _strings_ and as _enum literals_. The folder contains the library sources in SysML and in JupyterLab format.

## Transformation example

`JSonTransformer` transforms a SysML model annotated with `TraceaLibrary` into three distinct representations of the model: a graphical representation using D3-JSon, a matrix-based representation and a SysML textual representation. 

A usage example of `TraceaLibrary` is given in [`/20-eDrone_example`](https://github.com/modelia/tracea/tree/master/4-sysml-json-transformer/20-eDrone_example).

[`/21-eDrone_out`](https://github.com/modelia/tracea/tree/master/4-sysml-json-transformer/21-eDrone_out) contains the output of JSonTransformer on this example. File containing `_out` have been generated.

## Graphical representation

We use D3-JSon to generate a graphical instance of the trace. The source script to provide the following UI is found in [`/30-d3-script`](https://github.com/modelia/tracea/tree/master/4-sysml-json-transformer/30-d3-script) and a usage example [`here`](http://www-ens.iro.umontreal.ca/~batotedo/tracea/v1/). The following picture illustrates the UI.

<img src="https://github.com/modelia/tracea/blob/master/4-sysml-json-transformer/imgs/visualization1.jpg" alt="Graph visualization" width="350"/>

## Matrix-based representation

The second output representation JSonTransformer yields is a matrix based representation as illustrated bellow and accessible [`here`](http://www-ens.iro.umontreal.ca/~batotedo/tracea/v1/eDrone_example_out.html).

<img src="https://github.com/modelia/tracea/blob/master/4-sysml-json-transformer/imgs/tracematrix1.jpg" alt="Matrix-based representation" width="350"/>

## SysMLv2 re-injection

Following is an excerpt of the patch generated by JSonTransformer to reinject the example trace into the SysML model. This patch-system can also be used to populate the trace with more metadata comming from external sources.

```SysML
package eDrone_example {
	import TracingAnnotations::*;	
    
    import eDroneRequirement_Definitions::*;
    import eDrone_Requirements::*;
    import eDrone_LogicalArchitecture::*;
    import eDrone_Definitions::*;
    import eDrone_Library::*;

    connection eng2front connect eDrone.engine to eDrone.frontAxis;
    connection frAx2frWi connect eDrone.frontAxis to eDrone.frontWing;
    ...   
    connection eng2bat_Typed: EngineToBattery connect supplierPort :> eDrone.battery.powerOut to 
        consumerPort :> eDrone.engine.powerIn;
    
    /* Added trace links */
    connection refine1 connect eDrone.battery to eDrone.battery.powerOut;
    connection refine2 connect eDrone.battery to eDrone.engine.powerIn;
    
    
    
    /* Trace link annotations */
       metadata m7160: ConfidenceTracing about eng2front { confidence = 0.85;}
       metadata m1014: TraceType         about eng2front { tracetype = "TypeE";}
       metadata m7180: ConfidenceTracing about frAx2frWi { confidence = 0.65;}
       ...
       metadata m1018: TraceType         about refine1 { tracetype = "Convenience";}
       metadata m7157: ConfidenceTracing about refine2 { confidence = 0.55;}
       metadata m1019: TraceType         about refine2 { tracetype = "Convenience";}
}

```

## Executable - JSonTransformer

`JSonTransformer.jar` is an executable JAR file for [`JSonTransformer`](https://github.com/ebatot/TraceaingJson). The version of the JAR corresponds to the module [`/TraceaingJSon @ 2109c56`](https://github.com/ebatot/TraceaingJson/tree/2109c562598807b8b7797af3b9dd5f54fc5c5202).

## ID allocation unexpected behavior

We report an unexpected behavior of SysMLv2 in the allocation of IDs in [`/40-sysml_id_allocation_bug`](https://github.com/modelia/tracea/tree/master/4-sysml-json-transformer/40-sysml_id_allocation_bug). Jupyter file (`ipynb`) contains a JupyterLab notebook illustrating the problem on a simple example. `Feature-ID-allocation.json` contains the generated JSon export of the model.
